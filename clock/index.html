<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>briankung.xyz - 阿公 clock</title>
  <link rel="apple-touch-icon" href="images/icons/icon-192x192.png">

  <style>
    body, html {
      background-color: black;
      height: 100%;
      display: grid;
    }

    svg {
      width: 100%;
      margin: auto;
    }

    text {
      font-family: 'SimSun', sans-serif;
      fill: #f8f8ff;
    }

    text tspan {
      font-size: x-small;
    }
  </style>
</head>
<body onclick="toggleFullscreen()">
  <svg viewBox="0 0 60 18">
    <text id="clock" x="0" y="15"></text>
  </svg>
</body>
</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/nosleep/0.12.0/NoSleep.min.js" integrity="sha512-DSzvYfxJWRi3E6vfcGQfL5CqOlApxYrrdqRP3hRCnoiZ0oM6+ccYjbtdzQFUrAOI/ehKk0VKFuKs5GseGPkVjQ==" crossorigin="anonymous"></script>

<script>
  const MILLISECONDS = 1000,
        ONE_SECOND = MILLISECONDS,
        ONE_MINUTE = MILLISECONDS * 60,
        clock = document.getElementById('clock'),
        noSleep = new NoSleep();

  function toggleFullscreen() {
    document.webkitIsFullScreen == undefined ? standardToggleFullscreen() : webkitToggleFullscreen();
    noSleep.enabled ? noSleep.disable() : noSleep.enable();
  };

  function webkitToggleFullscreen() {
    document.webkitIsFullScreen ? document.webkitExitFullscreen() : document.body.webkitRequestFullscreen();
  };

  function standardToggleFullscreen() {
    document.fullscreen ? document.exitFullscreen() : document.body.requestFullscreen();
  };

  function updateDisplayTime() {
    const date = new Date,
          timeString = date.toLocaleString(
            'zh-CN',
            {
              hour: 'numeric',
              minute: 'numeric',
              hour12: true
            }
          ),
          [_, ampm, time] = timeString.match(/^(.{2})(.+)$/),
          tspan = document.createElementNS("http://www.w3.org/2000/svg", "tspan");

    tspan.textContent = ampm;
    clock.textContent = time;
    clock.prepend(tspan);
  };

  updateDisplayTime();

  window.setTimeout(
    () => window.setInterval(updateDisplayTime, ONE_MINUTE),
    (ONE_MINUTE - ((new Date).getSeconds() * MILLISECONDS))
  );
</script>

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>briankung.xyz - 阿公 clock</title>
  <link rel="apple-touch-icon" href="images/icons/icon-192x192.png">

  <style>
    body, html {
      background-color: black;
      height: 100%;
      display: grid;
    }

    svg {
      width: 100%;
      margin: auto;
    }

    text {
      font-family: 'SimSun', sans-serif;
      fill: #f8f8ff;
    }

    text tspan {
      font-size: x-small;
      fill: darkgray;
    }
  </style>
</head>
<body onclick="toggleFullscreen()">
  <svg id="svg">
    <text id="clock" x="0" y="15"></text>
  </svg>
</body>
</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/nosleep/0.12.0/NoSleep.min.js" integrity="sha512-DSzvYfxJWRi3E6vfcGQfL5CqOlApxYrrdqRP3hRCnoiZ0oM6+ccYjbtdzQFUrAOI/ehKk0VKFuKs5GseGPkVjQ==" crossorigin="anonymous"></script>

<script>
  const MILLISECONDS = 1000,
        ONE_MINUTE_IN_MILLISECONDS = MILLISECONDS * 60,
        NO_SLEEP = new NoSleep(),
        CLOCK = document.getElementById('clock'),
        MS_TO_NEXT_MINUTE = (ONE_MINUTE_IN_MILLISECONDS - ((new Date).getSeconds() * MILLISECONDS)),
        SVG = document.getElementById('svg'),
        SVG_VIEWBOX_ZOOM_IN = "0 0 60 18",
        SVG_VIEWBOX_ZOOM_OUT = "0 0 51 18";

  function toggleFullscreen() {
    document.webkitIsFullScreen == undefined ? standardToggleFullscreen() : webkitToggleFullscreen();
    NO_SLEEP.enabled ? NO_SLEEP.disable() : NO_SLEEP.enable();
  };

  function webkitToggleFullscreen() {
    document.webkitIsFullScreen ? document.webkitExitFullscreen() : document.body.webkitRequestFullscreen();
  };

  function standardToggleFullscreen() {
    document.fullscreen ? document.exitFullscreen() : document.body.requestFullscreen();
  };

  function updateDisplayTime() {
    const [_, ampm, time] = (new Date)
            .toLocaleString('zh-CN', {
              hour: 'numeric',
              minute: 'numeric',
              hour12: true
            })
            .match(/^(.{2})(.+)$/),
          tspan = document.createElementNS("http://www.w3.org/2000/svg", "tspan");

    tspan.textContent = ampm;
    CLOCK.textContent = time;
    const [hours, minutes] = time.split(':')

    if (hours.length > 1) {
      SVG.setAttribute('viewBox', SVG_VIEWBOX_ZOOM_IN);
    } else {
      SVG.setAttribute('viewBox', SVG_VIEWBOX_ZOOM_OUT);
    };

    CLOCK.prepend(tspan);
  };

  window.setTimeout(
    () => {
      updateDisplayTime();
      window.setInterval(updateDisplayTime, ONE_MINUTE_IN_MILLISECONDS)
    },
    MS_TO_NEXT_MINUTE
  );

  updateDisplayTime();
</script>
